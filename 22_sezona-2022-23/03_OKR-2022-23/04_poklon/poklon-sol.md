---
title: Поклон - опис решења
---

# Поклон

Аутор: Јован Бенгин
Текст и тест примери: Јован Бенгин
Анализа решења: Драган Урошевић
Тестирање: Игор Павловић


 ### Решење првог подзадатка
У овом случају, због ограничења на дужину низа $A$ (број $N$) и број упита $Q$, могуће је за сваки упит $(L_i, R_i)$ проверити да ли подниз постаје сортиран након избацивања елемента $A_j$ ($j= L_i, L_i+1, L_i+2, \dots R_{i-1}, R_i$). Провера да ли је низ сортиран изводи се тако што се пореде парови узастопних (наравно, узимајући у обзир да је избачен елемент $A_j$, па су елементи $A_{j-1}$ и $A_{j+1}$, ako je $L_i < j < R_i$, узастопни). Сложеност овог решења је $O(QN^2)$.

 ### Решење другог и трећег подзадатка
Решење ових подзадатака добија се "профињењем" решења за први задатак. То "профињење" се постиже тако што се за вредности $ј$ за које је $A_{j-1}\leq A_j \leq A_{j+1}$ не проверава да ли је подниз добијен избацивањем елемента $A_j$ сортиран (јер елемент $A_j$ "не смета", будући да је, по вредности, између елемената лево и десно од њега). Током обраде се проверава да ли је подниз који садржи све елементе од позиције  $L_i$ до позиције $R_i$ сортиран и ако јесте онда је одговор на упит "ДА". Наравно, и у случају да се за неко $j$ испостави да је подниз добијен након избацивања елемента $A_j$ сортиран, одговор је "ДА".

 ### Решење четвртог подзадатка
У овом подзадатку је могуће са сваки индекс $i$  ($1\leq i \leq N$) одредити:
- индекс $j$ ($j\geq i$) првог елемента у делу низа кога чине елементи $A_i, A_{i+1}, A_{i+2}, \dots, A_N$ који има вредност  $1$; означимо ту вредност са $next_{i,1}$; ако такав елемент не постоји онда ће одговарајући индекс имати вредност $N+1$. 
- индекс $j$ ($j\geq i$) првог елемента у делу низа кога чине елементи $A_i, A_{i+1}, A_{i+2}, \dots, A_N$ који има вредност  $2$; означимо ту вредност са $next_{i,2}$; ако такав елемент не постоји онда ће одговарајући индекс имати вредност $N+1$.

Овај део се може одрадити након учитавања елемената низа, а пре одговарања на упите.

Када одговарамо на упит за пар бројева $(L,R)$, онда одређујемо индекс $X$ првог елемента од позиције $L$ који има вредност $2$ ($X=next_{L,2}$) и индекс $Y$ првог елемента од позиције $X$ који има вредност $1$ ($Y=next_{X,1}$).
Може се показати да ће одговор бити "ДА" само у следећим случајевима

- ако је $Y>R$ (јер су елементи од позиције $L$ до позиције $X-1$ једнаки $1$, а од позиције $X$ па до позиције $Y-1\geq R$ једнаки $2$; 
- ако је $next_{Y+1,1}>R$, јер се може избацити јединица са позиције $Y$, и тако ће се добити блок двојки од позиције $X$ па до позиције $next_{Y+1,1}-1 \geq R$ и подниз ће бити сортиран;
- ако је $Y=X+1$ и  $next_{next_{Y,2},1}>R$, јер се на позицији $X$ налази број $2$, али одмах након тога број $1$, а након прве двојке после позиције $Y$ следи блок двојки који се завршава након позиције $R$; брисањем двојке на позицији $X$ добија се сортиран подниз.

У свим осталим случајевима, одговор је "НЕ".
Матрица $next$ може бити израчуната у времену $\Theta(N)$, а како је сложеност одговора на сваки упит $\Theta(1)$, то је укупна сложеност $\Theta(N+Q)$.

### Главно решење

За сваки индекс $i$ ($1\leq i \leq N$) се може одредити највећи индекс $j$ тако да је подниз од индекса $i$ до индекса $j$ неопадајући:
 $$
 A_i \leq A_{i+1} \leq A_{i+2} \leq \dotsb \leq A_{j-1} \leq A_j.
 $$
 Означимо индекс $j$ који има горњу особину  са $last_i$. Приметимо да је $last_i = N$ или је $A_{last_i} > A_{last_i+1}$. 
Тада ће одговор на упит за пар индекса $(L,R)$ бити "ДА" у следећим случајевима:

- ако је $last_L \geq R-1$ (јер може бити обрисан $A_R$)
- ако је $last_{last_L+1} \geq R$ и $last_L = L$ или је $A_{last_L-1} \leq A_{last_L+1}$, јер се брисањем елемента  $A_{last_L}$ добија сортиран подниз.
- ако је $last_{last_L+2} \geq R$ и $A_{last_L} \leq A_{last_L+2}$, јер се тада брисањем елемента $A_{last_L+1}$ добија сортиран подниз. 

Елементи низа $last$ могу бити срачунати коришењем следећих чињеница:

- $last_N = N$,
- $last_i = last_{i+1}$ ако је $A_i \leq A_{i+1}$ и $last_i = i$, ako je $A_i > A_{i+1}$, за $i=N-1, N-2, \dots, 2, 1$.
Према томе, сложеност израчунавања елемената низа $last$ је $\Theta(N)$, а будући да је сложеност одговарања на један упит $\Theta(1)$, сложеност комплетног решења је $\Theta(N+Q)$.
