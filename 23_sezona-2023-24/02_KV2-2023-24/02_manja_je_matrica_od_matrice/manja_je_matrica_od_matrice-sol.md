---
title: Мања је матрица од матрице - опис решења
---

# Мања је матрица од матрице

Аутор: Павле Мартиновић
Текст и тест примери: Павле Мартиновић
Анализа решења: Младен Пузић
Тестирање: Александар Вишњић

У анализи решење сматраће се да први ред од горе има индекс $1$, последњи ред индекс $N$, прва колона слева има индекс $1$, а последња $M$.

## Решење када $K = L = 1$
Лепота матрице је сума свих подматрица димензија $1 \times 1$, што је у ствари збир свих елемената матрице. Дакле, како год распоредили елементе, лепота матрице биће иста и то збир свих елемената низа $A$.

Временска и меморијска сложеност је $O(NM)$.

## Решење када $N = M = 3, K = L = 2$
Пошто матрица има само $9$ поља, постоји $9! = 362.880$ могућности за распоређивање низа $A$ у матрицу. Назовимо матрицу $m$ - лепота матрице након фиксираног низа јесте (може се видети ако се испишу заједно суме свих подматрица димензије $2\times 2$):

$$
m_{1, 1} + 2\cdot m_{1, 2} + m_{1, 3} + 2\cdot m_{2, 1} + 4\cdot m_{2, 2} + 2\cdot m_{2, 3} + m_{3, 1} + 2\cdot m_{3, 2} + m_{3, 3}
$$

Од свих могућих опција, бирамо ону која максимизира горенаведену формулу.

Временска сложеност је $O((NM)!)$, а меморијска $O(NM)$.

## Решење када $K, L \leq 5$
Пошто су димензије посматраних подматрица мале, ми можемо грубом силом израчунати за свако поље у колико подматрица димензије $K \times L$ се налази, следећим алгоритмом:

* Иницијализујемо матрицу $cnt_{i, j} = 0$, за свако $1 \leq i \leq N$ и $1 \leq j \leq M$;
* За свако могуће горње лево поље $(x, y)$ (ово су сва поља за која важи $1 \leq x \leq N-K+1$ и $1 \leq y \leq M-L+1$):
    * За свако поље $(i, j)$ за које важи $x \leq i < x+K$ и $y \leq j < y+L$ увећати $cnt_{i, j}$ за један.

Након тога, све вредности из матрице $cnt$ пребацимо у низ који сортирамо. Највећу вредност низа $A$ потребно је ставити на поље које се појављује у највише посматраних подматрица, другу највећу вредност у поље које се појављује у другом највећем броју подматрица, итд.

Временска сложеност је $O(NMKL + NM\log(NM))$, а меморијска $O(NM)$.

## Решење када $0 \leq A_i \leq 1$
Пошто имамо само две могуће вредности, желимо јединице ставити у поља која се налазе у највећем броју подматрица димензије $K\times L$, док нуле стављамо у поља која се ређе појављују. Дакле, желимо да за свако поље ефикасно пронађемо у колико посматраних подматрица се налази (ово не зависи од расподеле елемената у матрици).

Када бисмо имали бесконачну таблу, поље $(i, j)$ би садржао сваки правоугаоник димензије $K\times L$ чији је горње лево поље $(x, y)$, где важи $i-K+1 \leq x \leq i$ и $j-L+1 \leq y \leq j$. Уколико урачунамо да ивице матрице могу да смање наш број опција, добијамо да мора да важи: 

$$
\max(i-K+1, 1) \leq x \leq \min(N-K+1, i)
$$

$$
\max(j-L+1, 1) \leq y \leq \min(M-L+1, j)
$$

Из овога се може закључити да се број подматрица које садрже поље $(i, j)$, дакле, $cnt_{i, j}$, може израчунати формулом:

$$
cnt_{i, j} = (\min(N-K+1, i) - \max(i-K+1, 1) + 1) \cdot (\min(M-L+1, j) - \max(j-L+1, 1) + 1)
$$

Даље, избројимо број јединица у низу $A$ и решење је збир толико највећих елемената из матрице $cnt$.

Временска сложеност је $O(NM\log(NM))$, а меморијска $O(NM)$.

## Главно решење
Попут решења када $0 \leq A_i \leq 1$ за свако поље проналазимо у колико посматраних подматрица се налази, а попут решења када $K, L \leq 5$ упарујемо највећи елемент низа $A$ са оном позицијом која се појављује у највише посматраних подматрица.

Временска сложеност је $O(NM\log(NM))$, а меморијска $O(NM)$.
