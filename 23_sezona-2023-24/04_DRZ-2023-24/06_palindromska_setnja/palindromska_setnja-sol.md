---
title: Палиндромска шетња - опис решења
---

## Палиндромска шетња

Аутор: Алекса Милисављевић
Текст: и тест примери: Алекса Милисављевић
Анализа решења: Алекса Милисављевић
Тестирање: Павле Мартиновић

###  Решење када је у сваком упиту $c = `a`$

У овом подзадатку је свака шетња палиндром. Довољно је проверити да ли су два чвора у истој компоненти повезаности.  Ово можемо да постигнемо тако што користимо чувамо којој компоненти припада који чвор. Сваки упит у којем се граном повезују два чвора из исте компоненте игноришемо. Када се спајају два чвора из различитих компоненти, додајемо нову грану између њих и пуштамо `bfs` у којем све чворове до којих је могуће стићи до једног из та два стављамо у исту компоненту. Ово решење ради у сложености $O(N^2 + Q)$. За бољу сложеност је потребно користити адекватну структуру, нпр. `dsu (disjoint set union)`.

### Решење када је у сваком упиту првог типа $v = u + 1$

У овом подзадатку је описани граф заправо низ. Потребно је проверити да ли је за дати подниз могућа палиндромска шетња од једног до другог краја. Палиндромска шетња постоји уколико при компресији узастопних истих карактера добијамо палиндром и ако су одговарајући наспрамни карктери настали компресијом подниза узастопних исте парности. Ово можемо урадити тако што унапред израчунамо који ће парови формирати палиндромску шетњу након свих упита у сложености $O(N^2)$. Потом процесирамо упите. После сваког ажурирања водимо рачуна о компонентама повезаности (користећи `dsu` или пуштајући `bfs` након сваког упита). Ово решење ради у сложености $O(N^2 + Q)$.

###  Решење када $N \leq 100$

Да би решили овај подзадатак, морамо да приметимо пар ствари. Посматрајмо следећу релацију над неуређеним паровима чворова:

* $(a,b)$ је у релацији са $(x,y)$ $\leftrightarrow$ могуће је стићи палиндромском шетњом од $a$ до $b$ акко је могуће стићи палиндромском шетњом од $x$ до $y$ .

Приметимо да је ово релација еквиваленције. Штавише, приметимо да је у свакој класи екиваленције у којој су палиндромске шетње бар један неуређен пар облика $(a,a)$ или облика $(a,b)$, где постоји грана између $a$ и $b$. Додавањем гране између чворова $u$ и $v$ са карактером $c$ стапа неке класе еквиваленције у једну. Посматрајмо све гране $(x,y)$ на којима је написан карактер $c$. Тада се стапају тачно следеће класе еквиваленције:

* $(x,u)$ и $(y,v)$ у једну класу еквиваленције (јер ако је постоји палиндромска шетња између $x$ и $u$, тада постоји и палиндромска шетња између $y$ и $v$, нпр продужавањем претходне гранама $(x,y)$ и $(u,v)$).

* $(x,v)$ и $(y,u)$ у једну класу еквиваленције.

Према томе за сваку додату грану, можемо итерирати по свим претходним додатим гранама истог типа и спајати одговарајуће класе еквиваленције. Ово решење ради у временској сложености $O(N^4 + N^2 \log N + Q \log N)$.

### Решење без додатних ограничења

За овај подзадатак, неопходно је оптимизовати претходно решење. Можемо приметити да није неопходно итерирати кроз све претходне гране, већ можемо да прескочимо гране које би формирале циклус који не мења бипартитност компоненте повезаности на истом карактеру. Формално, претпоставимо да додајемо грану између $u$ и $v$ са карактером $c$. Тада, разликујемо следеће случајеве:

* $u$ и $v$ до сада нису били повезани у подграфу који је формиран гранама са карактером $c$. Тада процесирамо ову грану.
* $u$ и $v$ јесу у истој компоненти повезаности и та компонента је бипартитна, али додавањем нове гране, та компонента престаје бити бипартитна. Тада процесирамо ову грану.
* У супротном игноришемо додавање гране. Пажљивијом анализом класа које се стапају у једну из решења претходног подзадатка се може видети да грана у овом случају не би стопила никоје две класе еквиваленције, нити би утицала на неке наредне упите.

Према томе, за сваки карактер, грана које треба да процесирамо има $O(N)$ (зашто?). Ово решење ради у сложености $O(N^2 \cdot |\Sigma| \cdot \log N)$.


