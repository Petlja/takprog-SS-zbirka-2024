---
title: Старући прстен - опис решења
---

# Старући прстен
Аутор: Павле Мартиновић
Текст и тест примери: Алекса Милисављевић
Анализа решења: Павле Мартиновић
Тестирање: Павле Мартиновић

## Решење када $P_i=0$

Приметимо да ћемо у овом случају увек радити директан напад, тако да ћемо после $k$ потеза нанети укупно $S_k=D_1+D_2+\cdots+D_k$ поена штете. Овај низ је сортиран, те бинарном претрагом за сваки упит можемо да нађемо најмањи елемент $S$ који је већи од траженог $H_i$. Сложеност је $O(N+Q\log N)$.

## Решење када $D_i=0$

У овом случају ћемо увек радити напад отровом, тако да после $k$ потеза ћемо нанети укупно $S_k=k\cdot P_1+(k-1)\cdot P_2+\cdots+1\cdot P_k$ поена штете. Ако срачунамо овај низ, можемо завршити бинарном претрагом, као и у првом подзадатку. Ово се, међутим, лако може урадити тако што се узме парцијална сума парцијалних сума низа $P_i$. Сложеност је $O(N+Q\log N)$.

## Решење када $D_i=0$

У овом случају ћемо увек радити напад отровом, тако да после $k$ потеза ћемо нанети укупно $S_k=k\cdot P_1+(k-1)\cdot P_2+\cdots+1\cdot P_k$ поена штете. Ако срачунамо овај низ, можемо завршити бинарном претрагом, као и у првом подзадатку. Ово се, међутим, лако може урадити тако што се узме парцијална сума парцијалних сума низа $P_i$. Сложеност је $O(N+Q\log N)$.

## Решење када је $Q\leq 10$
У даљим подзадацима, слично као у прва два случаја, означићемо са $S_k$ колико највише штете можемо нанети у првих $k$ потеза. У овом подзадатку ћемо показти како се произвољно $S_k$ може срачунати у $O(N)$. Заиста, приметимо да ако знамо да ћемо радити тачно $k$ потеза, онда у неком $i$-том потезу имамо избор да или радимо $D_i$ штете директним нападом, или $P_i$ отрова које ће трајати $k-i+1$ потеза, односно нанети укупно $(k-i+1)P_i$ штете. Пошто је $k$ фиксирано, потребно је само изабрати већу од ове две вредности. Сада радимо бинарну претрагу по $S$, али рачунајући конкретне вредности за $S_i$ само кад су нам потребне (јер је низ свакако сортиран). Ово нам даје сложеност $O(QN\log N)$.
## Решење када нема упита првог типа
У овом случају можемо лако срачунати низ $S_i$. Заиста, због услова важи да једини потез кад је можда оптимално применити директан напад последњи пред убијање, те су нам једине опције за $S_k$ или оно што је било у другом подзатаку, или $k\cdot P_1+(k-1)\cdot P_2+\cdots+2\cdot P_{k-1}+D_k$. Узимајући максимум од те две вредности, налазимо низ $S_k$, и можемо опет да завршимо бинарном претрагом као у прва два подзадатка. Сложеност $O(N+Q\log N)$.

## Главно решење

У овом решењу ћемо срачунати све вредности $S_k$ у $O(N)$, ослањајући се на опсервације из трећег подзадатка. Главно је видети да за свако $i$, како померамо $k$ ће нам прво бити оптимално радити директан напад, па онда од  $k\ge i+\lfloor\frac{D_i}{P_i}\rfloor$ ће бити оптимално радити напад отровом. Сада померамо $k$ и запамтимо „догађаје“ облика од када је оптимално радити напад отровом. Када наиђемо на нови догађај прерачунамо вредност нанете штете до сад ако бисмо урадили напад отровом уместо директног напада у том потезу, и додамо тај отров на неки бројач тоталног отрова. Затим у сваком потезу додамо тотали отров и нађемо нову вредност низа $S$. Овиме смо срачунали низ $S$ и можемо опет бинарном претрагом довршити задатак у $O(N+Q\log N)$
