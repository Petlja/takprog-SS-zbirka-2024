# Turris inclinata
Аутор: Павле Мартиновић
Текст и тест примери: Павле Мартиновић
Анализа решења: Алекса Милисављевић
Тестирање: Алекса Милисављевић

## Решење када $N\le20$, $Q\le 50$, $P[i]=2$
У овом подзадатку можемо да симулирамо процес пењања на торањ. Сложеност $O(Q \cdot 2^N)$.

## Решење када $N\le2.500$, $Q\le 20$
Приметимо прво да чим први пут пређемо неки спрат успешно, то значи да на свим спратовима до њега имамо $0$ покушаја по модулу одговарајућег спрата. Сваки упит решавамо независно. Нека је $dp[i]$ потребан укупан број покушаја да пређемо $i$-ти спрат, уколико на свим мањим имамо $0$ неуспешних покушаја. Тада је $dp[i] = dp[j] + dp[j+1] + ... + dp[i-1]$, где је $j = max(X, F[i])$. Коначно решење је $dp[X] + dp[X+1] + ... + dp[N]$. Сложеност овог решења је $O(N^2 \cdot Q)$.

## Решење када је $N\le300.000$, $Q\le 20$
Сваки упит решавамо независно. Приметимо да можемо оптимизовати решење претходног подзадатка коришћењем префиксних сума. Сложеност овог решења је $O(N \cdot Q)$.

## Решење када је $F[i]\ge i-10$
Нека је $pref[i] = dp[1] + dp[2] + ... + dp[i]$. Приметимо да je решење линеарна комбинација $pref[X-1], pref[X+1], pref[X+2], ..., pref[X+10]$. Можемо да процесирамо вредности $X$ опадајуће и ажурирамо коефицијенте ове линеарне комбинације. Сложеност овог решења је $O(N + Q)$.

## Главно решење
Приметимо да можемо да симулирамо процес од последњег спрата. За сваки спрат памтимо колико смо пута морали да га пређемо. Иницијализујмо ову променљиву на $1$ за сваки спрат и означимо је са $T[i]$. Последњи спрат морамо да пређемо тачно $T[N] = 1$. Међутим, пошто ћемо направити $P[N]-1$ неуспешних покушаја, ово значи да смо све спратове од $F[N]$ до $N-1$ морали да пређемо барем још $P[N] - 1$ пута више, тј. $T[i]$ се повећава за $P[N] - 1$ за све $F[N] \leq i \leq N-1$. Према томе претпоследњи спрат смо морали да пређемо $T[N-1] = 1 + (P[N] - 1)$. Међутим, пошто смо направили $P[N-1] - 1$ неуспешан покушај за сваки успешан, ово повећава $T[i]$ за  $T[N-1] \cdot (P[N-1] - 1)$ за $F[N-1] \leq i \leq N-2$. Ово повећавање можемо симулирати додавањем вредности за колико треба променити префикс на одговарајући елемент или коришћењем сегментног стабла. Коначно, одговор на упит је $T[X] \cdot P[X] + T[X+1] \cdot P[X+1] + ... + T[N] \cdot P[N]$. Ову суму можемо ефикасно пронаћи коришћењем суфиксних сума. Сложеност овог решења је $O(N + Q)$.
