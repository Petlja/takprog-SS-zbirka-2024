# E pluribus unum

 
Аутор: Александар Вишњић
Текст и тест примери: Александар Вишњић
Анализа решења: Александар Вишњић
Тестирање: Јован Бенгин

Нека је одговор за датог миксотрофа $T$. Приметимо да је њему оптимално да буде аутотроф од дана $0$ до дана $T-1$. Тек у дану $T$ изабере да се храни хетеротрофно, и тад одједном поједе све остале бактерије. Ово важи јер ако у првом дану када одлучи да се храни хетеротрофно не поједе све остале бактерије, мора још дана да чека. Ово му касније онемогућава да добија на величини на бактеријама које је већ појео (само непоједене бактерије које се хране аутотрофно могу нарасти). Дакле, више ће нарасти ако се у том првом дану хранио аутотрофно.

### Први подзадатак
За сваку бактерију, могуће је бинарно претражити одговор. Креирајмо граф и израчунајмо нове величине након претпостављених $T_i$ тренутака. Тренутна бактерија $i$ у сваком тренутку бира најмањег суседа и поједе га. Уколико не може да поједе ни најмањег суседа, онда провера пада. Ако може појести све остале бактерије, онда провера пролази. Најмањи сусед се може наћи преко приоритетног реда. Временска сложеност је $O(NM(\log N)^2)$.
  

### Други подзадатак
Потребно је брже наћи одговор за сваку бактерију. Када је у питању низ, можемо користити бинарну претрагу по вредности решења и памтити тренутну границу $[l_i,r_i]$ коју је бактерија $i$ појела. Уколико су бактерије $l_i -1$ и $r_i+1$ веће од тренутне величине $i$, провера пада. Иначе, појешће највећи број узастопних бактерија које може појести улево, и највећи такав број удесно. Те границе је могуће наћи бинарном претрагом по префиксној суми низа. Приметимо да се након две симулације ових корака величина бактерије порасте барем дупло, те је број корака $O(\log S)$, где са $S$ означавамо збир величина свих бактерија на почетку. Ово даје укупну временску сложеност $O(N(\log N)^2 \log S)$.

### Трећи подзадатак
Могуће је елиминисати бинарну по решењу. Провера остаје иста, с тим што у њу убацујемо "предомишљање". За тренутну бактерију симулирамо процес и претпоставимо њено почетно оптимално време са $T_i=0$. Кад год наиђемо на ситуацију где она не може више нарасти, "предомислимо" се и поставимо $T_i$ на најмању вредност која би јој дозволила да поједе бар једног суседа. Како је ипак оптимално да бактерија чека до тог првог тренутка, потребно је одговарајуће ажурирати њену тренутну величину рачунајући да ће јој тренутно поједене бактерије донети допринос. Ово је могуће решити правилно постављеним математичким формулама. Сложеност је $O(N\log N \log S)$.
  

### Четврти подзадатак

Приметимо да ако бактерија може појести све остале у неком тренутку, то ће урадити најкасније у тренутку $20$. Ту константу бирамо јер је то највећа величина бактерије у овом подзадатку. Фиксирајмо неки универзални тренутак $0 \leq T \leq 20$. Одједном проверавамо које бактерије могу појести све остале, а које не могу. Аналогно са прошлим подзадатком, уместо повезаних сегмената памтимо повезане компоненте. Њих је могуће одржати преко уније дисјунктних скупова (DSU). Компонента може појести другу ако им укупне величине то дозвољавају. За сваку је потребно памтити и скуп (vector) бактерија које могу појести све остале у тој компоненти (очито се може десити да само неке имају ту способност, и све које то могу ће имати исту величину на крају). Ако правилно радимо спајање мање компоненте у већу, имамо решење сложености $O(N T \log N)$. Овде $T$ представља најкаснији смислени тренутак.
  

### Главно решење
Комбинујемо идеје из претходна два подзадатка. Одржаваћемо унију дисјунктних скупова (DSU) са "предомишљањем". Унутар компоненте, за сваку бактерију синхронизовано памтимо њен тренутни најмањи претпостављен тренутак. Приметимо да им се величине због различитих времена разликују, али да ће најмања бактерија управо бити она са најмањим претпостављеним тренутком. Приликом спајања две компоненте, потребно је дозволити и најмањој бактерији да поједе одговарајућу суседну бактерију. Ако је потребно, ту вршимо "предомишљање" применом одговарајуће математичке формуле. Пошто нам је потребно тражење минимума и вршење промена у колекцији, мораћемо да користимо структуру података (попут приоритетног реда). Након два "предомишљања", величина бактерије се дуплира. Овим је број таквих, за једну бактерију, ограничен са $O(\log S)$. Иако при једном спајању можемо извршити велик број операција, претходно увиђање нам амортизује сложеност, те је укупна $O(N(\log N)^2 + N\log S)$.

### Бонус
Решити задатак у сложености $O(N(\log N + \log S))$.