

# Quaestio militaris formationis
Аутор: Павле Мартиновић
Текст и тест примери: Марко Шишовић
Анализа решења: Павле Мартиновић
Тестирање: Драган Урошевић
## Решење када $N\leq 10$
Напросто за сваку од $N!$ пермутација можемо израчунати колико инверзија дају. Сложеност $O(N^2N!)$.
## Решење када није потребно наћи низ слабости
Нека дефинишимо дистанцу $d$ две прермутације $p,q$ као најмањи број замена суседних елемената да би се стигло од једног до другог. Ако $id$ означава пермутацију идентитете, знамо да је $d(id,p)$ заправо број инверзија пермутације $p$. Такође, једна тривијална опсервација је да је $d(p,q)=d(r\circ p,r\circ q)$ јер у овом случају само мењамо $i$ са $r[i]$ у обе пермутације, што очигледно никако не мења проблем. Означимо са $r^{-1}$ инверзну пермутацију пермутације $r$. За дате пермутације $p$ и $q$, нама је потребна минимална вредност $\max\{d(id,r\circ p),d(id,r\circ q)\}$ по свим $r$, односно $\max\{d(r^{-1},p),d(r^{-1},q)\}$. Пошто је очигледно $d(p,r^{-1})+d(r^{-1},q)\ge d(p,q)$ (можемо да добијемо $q$ од $p$ тако што прво добијемо $r^{-1}$ у минималном броју потеза па онда одатле $q$ у минималном броју потеза), знамо да је тражена вредност барем $\lceil\frac{d(p,q)}{2}\rceil$. Међутим, ову вредност је могуће добити, просто узмемо најкраћи низ замена суседних који води од $p$ до $q$ и онда кад смо на пола тога станемо и прогласимо ту пермутацију за $r^{-1}$ (и одатле пронађемо $r$). Сада нам је потребна само вредност $d(p,q)=d(id,p^{-1}q)$ што је само број инверзија ове пермутације и лако се може наћи у $O(N^2)$ провером по свим паровима, или $O(N\log N)$ стандардним начиним преко Фенвиковог стабла.
## Решење када је $N\leq 3000$
Тражимо пермутацију $a=p^{-1}r^{-1}$ тако да је $\max\{d(id,a),d(a,p^{-1}q)|\}=\lceil\frac{d(p,q)}{2}\rceil$, из чега ћемо лако конструисати шта је $r$. За ово је потребно да изаберете ваш омиљени алгоритам сортирања који ради у квадратном времену и ради тако што само мења суседне елементе ако су у инверзији (на пример "bubble sort"), кренете да сортирате пермутацију $p^{-1}q$ и станете на пола. Сложеност $O(N^2)$.
## Главно решење
Решење ћемо наћи налажење погодног квадратног алгоритма, чије бројање инверзија можемо да симулирамо брже од квадратног. Стандардно тражење броја инверзија преко Фенвиковог стабла ће нам после $i$-тог потеза наћи број инверзија у префиксу дужине $i$. Међутим, ово је управо број инверзија који је извршио "insertion sort" када је завршио са $i$-тим елементом, а овај сорт је један од оних који мења само суседне који су у инверзији. Тако да можемо да радимо рачунање броја инверзија пермутације $p^{-1}q$ стандардним алгоритмом Фенвиковим стаблом, и кад се деси да број инверзија пређе половину свих инверзија, сортирамо тај префикс, и онда урадимо са $i$-тим тачно онолико замена колико нам треба да би дистанца била тачно пола. Сложеност $O(N\log N)$.
